<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo - Quiz</title>
    <link rel="stylesheet" href="./css/styles.css">
</head>

<body>
    <div class="main-quiz" id="main-quiz">
        <div id="sidebar"></div>
        <!-- <h2>QUIZ</h2> -->
         <h2 id="h2Quiz" class="h2Quiz">QUIZ BÍBLICO</h2>
         <p class="pquiz" id="pquiz">Clique em "Iniciar Quiz" para começar a jogar.</p>
        <img src="./assets/quiz.png" alt="QUIZ" class="imgquiz" id="imgquiz">
        <div id="pontuacaoEJogo">
            <div id="quiz-cards" class="quiz-cards">
                <div class="card" data-quiz="livroAtos">
                    <h4>Quiz Livro de Atos</h4>
                    <img src="./assets/atos.png" alt="">

                    <button class="btnIniciarQuiz">Iniciar Quiz</button>

                </div>
                <div class="card" data-quiz="biblia1">
                    <h4>Quiz Bíblia 1</h4>
                    <img src="./assets/biblia1.png" alt="">
                    <button class="btnIniciarQuiz">Iniciar Quiz</button>

                </div>
                <div class="card" data-quiz="biblia2">
                    <h4>Quiz Bíblia 2</h4>
                    <img src="./assets/biblia2.png" alt="">
                    <button class="btnIniciarQuiz">Iniciar Quiz</button>

                </div>
                <div class="card" data-quiz="livroMateus">
                    <h4>Quiz Livro de Mateus</h4>
                    <img src="./assets/mateus.png" alt="">
                    <button class="btnIniciarQuiz">Iniciar Quiz</button>

                </div>

            </div>


            <div id="jogo" class="width-fit-content flex-colunar border-secondary">

                <div id="infoQuestao" class="padding-8">
                    <span class="questao">Questão atual: <span id="spanNumeroDaQuestaoAtual" class="questao"></span> de
                        <span id="qtdQuestoes" class="questao"></span>
                        questões.</span>
                </div>

                <div id="perguntaDaQuestaoAtual" class="padding-8">
                    <span id="spanQuestaoExibida" class="text-bold"></span>
                </div>

                <div id="infoAlternativas" class="padding-8">
                    <span><em>Escolha uma opção dentre as abaixo:</em></span>
                </div>

                <div id="opcoes" class="flex-colunar padding-8">
                    <span>
                        <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />
                        <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                    </span>
                    <span>
                        <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />
                        <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                    </span>
                    <span>
                        <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />
                        <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                    </span>
                    <span>
                        <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />
                        <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                    </span>
                </div>

                <div id="botoes" class="flex-colunar padding-8 btn-botoes">
                    <button onclick="submeter()" id="btnSubmeter">Enviar resposta</button>

                </div>

            </div>
            <div id="pontuacao" class="flex-colunar width-fit-content border-primary pontuacao">
                <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                    <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span>
                    <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span>
                </div>
                <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                    <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                        <span id="spanPontuacaoFinal">***</span>
                    </span>
                    <span id="msgFinal" class="width-fit-content">***</span>
                </div>
            </div>
        </div>
    </div>
    <script src="/js/sessao.js"></script><!-- para a função de validar sessao
 funcionar e aparecer o nome do usário na side bar -->

    <script src="./js/sidebar.js"></script>
    <script>

        //vetor com 5 objetos(jsons), cada um representando uma pergunta com 4 alternativas e a alternativa correta.
        let quizLivroAtos = [

            {
                pergunta: "Quantas pessoas haviam no dia em que foi escolhido o substituto de Judas?",
                alternativaA: "120",
                alternativaB: "200",
                alternativaC: "110",
                alternativaD: "2 mil",
                alternativaCorreta: "alternativaA"
            },

            {
                pergunta: "Quem escreveu o livro Atos?",
                alternativaA: "Teófilo",
                alternativaB: "Lucas",
                alternativaC: "Moisés",
                alternativaD: "Mateus",
                alternativaCorreta: "alternativaB"
            },

            {
                pergunta: "Para quem foi escrito o livro de Atos?",
                alternativaA: "Teófilo",
                alternativaB: "Lucas",
                alternativaC: "Moisés",
                alternativaD: "Mateus",
                alternativaCorreta: "alternativaA"
            },
            {
                pergunta: "Depois de ressuscitar quantos dias Jesus ficou na Terra?",
                alternativaA: "10 dias",
                alternativaB: "30 dias",
                alternativaC: "40 dias",
                alternativaD: "1 dia",
                alternativaCorreta: "alternativaC"
            },
            {
                pergunta: "Antes de subir aos céus o que Jesus diz?",
                alternativaA: "'Nem só de pão viverá o homem'",
                alternativaB: "'Mas receberão poder quando o Espírito Santo descer sobre vocês, e serão minhas testemunhas tanto em Jerusalém como em toda a Judeia e Samaria e até os confins da Terra'",
                alternativaC: "'Amém'",
                alternativaD: "'O Senhor é meu Pastor e nada faltará'",
                alternativaCorreta: "alternativaB"
            },

        ]

        let quizBiblia1 = [

            {
                pergunta: "Quantos livros tem a bíblia?",
                alternativaA: "76",
                alternativaB: "66",
                alternativaC: "77",
                alternativaD: "29",
                alternativaCorreta: "alternativaB"
            },

            {
                pergunta: " “Pois, vós sereis julgados com o mesmo julgamento com que julgardes; e sereis medidos, com a mesma medida com que medirdes”. Em que passagem está na bíblia?",
                alternativaA: "Mateus 7:1-2",
                alternativaB: "Provérbios 7:14-15",
                alternativaC: "Êxodo 20:19-20",
                alternativaD: "Naum 1:3-4",
                alternativaCorreta: "alternativaA"
            },

            {
                pergunta: "Na biblia onde está os dez mandamentos?",
                alternativaA: "Gênesis 17",
                alternativaB: "Mateus 14",
                alternativaC: "Êxodo 20",
                alternativaD: "Hebreus 11",
                alternativaCorreta: "alternativaC"
            },
            {
                pergunta: "Qual o primeiro e o último livro da bíblia?",
                alternativaA: "Salmos - Isaías",
                alternativaB: "Matheus - Apocalipse",
                alternativaC: "Deuteronômio - Isaías",
                alternativaD: "Gênesis - Apocalipse",
                alternativaCorreta: "alternativaD"
            },
            {
                pergunta: "Quem foi a primeira pessoa na bíblia que realizou de multiplicações de pães?",
                alternativaA: "João Batista",
                alternativaB: "Jesus",
                alternativaC: "Moíses",
                alternativaD: "Paulo",
                alternativaCorreta: "alternativaB"
            },
            {
                pergunta: "Quantas pragas foram enviadas ao Egito?",
                alternativaA: "8",
                alternativaB: "9",
                alternativaC: "6",
                alternativaD: "10",
                alternativaCorreta: "alternativaA"
            },
            {
                pergunta: "Qual era o nome da montanha onde Moisés recebeu os 10 Mandamentos?",
                alternativaA: "Monte das Oliveiras",
                alternativaB: "Monte Horebe",
                alternativaC: "Monte Sinai",
                alternativaD: "Alcedama",
                alternativaCorreta: "alternativaC"
            },
            {
                pergunta: "Quem era a mãe de Samuel?",
                alternativaA: "Maria",
                alternativaB: "Isabel",
                alternativaC: "Marta",
                alternativaD: "Ana",
                alternativaCorreta: "alternativaD"
            },
            {
                pergunta: "Qual é o primeiro livro do Novo Testamento?",
                alternativaA: "João",
                alternativaB: "Atos dos Apóstolos",
                alternativaC: "Marcos",
                alternativaD: "Mateus",
                alternativaCorreta: "alternativaD"
            },
            {
                pergunta: "Quem foi o discípulo que traiu Jesus?",
                alternativaA: "Paulo",
                alternativaB: "Pedro",
                alternativaC: "Judas",
                alternativaD: "Mateus",
                alternativaCorreta: "alternativaC"
            },


        ]

        let quizBiblia2 = [

            {
                pergunta: "Quem foi lançado na cova dos leões por continuar orando a Deus?",
                alternativaA: "Moisés",
                alternativaB: "Davi",
                alternativaC: "Daniel",
                alternativaD: "Elias",
                alternativaCorreta: "alternativaC"
            },

            {
                pergunta: "Quantos dias e noites choveu durante o dilúvio de Noé?",
                alternativaA: "30",
                alternativaB: "20",
                alternativaC: "50",
                alternativaD: "40",
                alternativaCorreta: "alternativaD"
            },

        ]

        let quizLivroMateus = [

            {
                pergunta: "Quantos dias e noites Jesus jejuou?",
                alternativaA: "90 dias e 90 noites",
                alternativaB: "40 dias e 40 noites",
                alternativaC: "30 dias e 40 noites",
                alternativaD: "7 dias e 7 noites",
                alternativaCorreta: "alternativaB"
            },

            {
                pergunta: "Qual o parentesco de João e Tiago, Pedro e André?",
                alternativaA: "Irmãos",
                alternativaB: "Primos",
                alternativaC: "Amigos",
                alternativaD: "Tio e Sobrinho",
                alternativaCorreta: "alternativaA"
            },

            {
                pergunta: "O que Pedro e André faziam quando Jesus os convidou para lhe seguir?",
                alternativaA: "Dançavam",
                alternativaB: "Dormiam",
                alternativaC: "Pescavam",
                alternativaD: "Caçavam",
                alternativaCorreta: "alternativaC"
            },
            {
                pergunta: "Qual o primeiro milagre que Jesus realizou?",
                alternativaA: "Transformou Água em Vinho",
                alternativaB: "Curou um Leproso",
                alternativaC: "Multiplicação dos pães e peixes",
                alternativaD: "A cura do cego em Jericó",
                alternativaCorreta: "alternativaA"
            },
            {
                pergunta: "Quando Jesus fala sobre buscar primeiro o reino de Deus e sua justiça, ele acrescenta uma consequência a essas atitudes. Que consequência ele cita?",
                alternativaA: "Que as demais coisas serão acrescentadas",
                alternativaB: "Que você será como salomão",
                alternativaC: "Será exaltado no céu",
                alternativaD: "Viverá para sempre",
                alternativaCorreta: "alternativaA"
            },

        ]

        // variáveis globais    
        let numeroDaQuestaoAtual = 0
        let pontuacaoFinal = 0
        let tentativaIncorreta = 0
        let certas = 0
        let erradas = 0
        let quantidadeDeQuestoes = quizLivroAtos.length
        let listaDeQuestoes = [];
        // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

        function onloadEsconder() {
            document.getElementById('pontuacao').style.display = "none"
            document.getElementById('jogo').style.display = "none"
        } //IMPORTANTE: essa função esconde a interface do quiz até o usuario clicar em iniciar

        document.querySelectorAll('.btnIniciarQuiz').forEach(button => {
            button.addEventListener('click', (e) => {
                const card = e.target.closest('.card');
                const quizSelecionado = card.getAttribute('data-quiz');

                if (quizSelecionado === "livroAtos") {
                    listaDeQuestoes = quizLivroAtos;
                } else if (quizSelecionado === "biblia1") {
                    listaDeQuestoes = quizBiblia1;
                } else if (quizSelecionado === "biblia2") {
                    listaDeQuestoes = quizBiblia2;
                } else if (quizSelecionado === "livroMateus") {
                    listaDeQuestoes = quizLivroMateus;
                }

                iniciarQuiz(); // chamamos a função para iniciar o quiz
            });
        });

        function iniciarQuiz() {
            quantidadeDeQuestoes = listaDeQuestoes.length;
            document.getElementById('imgquiz').style.display = "flex";
            document.getElementById('pontuacao').style.display = "flex";
            document.getElementById('jogo').style.display = "flex";
            document.getElementById('pquiz').style.display = "none";
            document.getElementById('h2Quiz').style.display = "none";
            document.getElementById('main-quiz').style.backgroundImage = "url('./assets/banner-quiz.png')";


            // Oculta todos os botões de iniciar quiz
            document.querySelectorAll('.btnIniciarQuiz').forEach(btn => btn.style.display = "none");

            document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes;

            preencherHTMLcomQuestaoAtual(0);

            btnSubmeter.disabled = false;


            document.getElementById('quiz-cards').style.display = "none";

        } //IMPORTANTE: essa função inicia o quiz, preenche a primeira pergunta, ativa os botões e reseta estados.

        function preencherHTMLcomQuestaoAtual(index) {
            habilitarAlternativas(true)
            const questaoAtual = listaDeQuestoes[index]
            numeroDaQuestaoAtual = index
            console.log("questaoAtual")
            console.log(questaoAtual)
            document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
            document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
            document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
            document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
            document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
            document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
        } //pega a questão da lista pelo índice, mostra a pergunta e alternativas no html.

        function submeter() {
            const options = document.getElementsByName("option"); // recupera alternativas no html

            let hasChecked = false
            for (let i = 0; i < options.length; i++) {
                if (options[i].checked) {
                    hasChecked = true
                    break;
                }
            }

            if (!hasChecked) {
                alert("Não há alternativas escolhidas. Escolha uma opção.")
            } else {
                btnSubmeter.disabled = true

                habilitarAlternativas(false)
                checarResposta()
                setTimeout(() => {
                    avancar();
                }, 2000);
            }

        } // verifica se alguma alternativa foi marcada, desativa envio/ativa botão “Próxima”, chama a funcao checarResposta() para validar a resposta.

        function habilitarAlternativas(trueOrFalse) {
            let opcaoEscolhida = trueOrFalse ? false : true

            primeiraOpcao.disabled = opcaoEscolhida
            segundaOpcao.disabled = opcaoEscolhida
            terceiraOpcao.disabled = opcaoEscolhida
            quartaOpcao.disabled = opcaoEscolhida

        }

        function avancar() {

            btnSubmeter.disabled = false

            desmarcarRadioButtons()

            if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {// se o numero da questao atual for menor que a penultima questao
                preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
            } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) { // se o numero da questao atual for igual a penultima questaão
                alert("Atenção... a próxima é a ultima questão!")
                preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
               
            } else { // se não, finalize o jogo
                finalizarJogo()
            }
            limparCoresBackgroundOpcoes()
        }// avança para a próxima pergunta, se acabou, chama a funcao finalizarJogo()

        function tentarNovamente() {
            // atualiza a página
            window.location.reload()
        }

        function checarResposta() {
            const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual]// questão atual 
            const respostaQuestaoAtual = questaoAtual.alternativaCorreta // qual é a resposta correta da questão atual

            const options = document.getElementsByName("option"); // recupera alternativas no html

            let alternativaCorreta = null // variável para armazenar a alternativa correta

            options.forEach((option) => {
                if (option.value === respostaQuestaoAtual) {
                    alternativaCorreta = option.labels[0].id
                    console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                }
            })

            // verifica se resposta assinalada é correta
            options.forEach((option) => {
                if (option.checked === true && option.value === respostaQuestaoAtual) {
                    document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                    pontuacaoFinal++
                    certas++
                    document.getElementById("spanCertas").innerHTML = certas
                    numeroDaQuestaoAtual++
                } else if (option.checked && option.value !== respostaQuestaoAtual) {
                    const wrongLabelId = option.labels[0].id

                    document.getElementById(wrongLabelId).classList.add("text-danger-with-bg")
                    document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                    tentativaIncorreta++
                    erradas++
                    document.getElementById("spanErradas").innerHTML = erradas
                    numeroDaQuestaoAtual++
                }
            })
        } // Verifica se a alternativa marcada é correta, atualiza a pontuação. Colore as alternativas: Verde: correta; Vermelha: errada

        function limparCoresBackgroundOpcoes() {
            const options = document.getElementsByName("option");
            options.forEach((option) => {
                document.getElementById(option.labels[0].id).classList.remove("text-danger-with-bg")
                document.getElementById(option.labels[0].id).classList.remove("text-success-with-bg")
            })
        }// Remove estilos das alternativas.


        function desmarcarRadioButtons() {
            const options = document.getElementsByName("option");
            for (let i = 0; i < options.length; i++) {
                options[i].checked = false;
            }
        }//Desmarca todas as opções marcadas.

        function finalizarJogo() {
            let textoParaMensagemFinal = null
            let classComCoresParaMensagemFinal = null
            const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes  //Cálculo de pontuaçao

            if (porcentagemFinalDeAcertos <= 0.3) {
                textoParaMensagemFinal = "Parece que você não estudou..."
                classComCoresParaMensagemFinal = "text-danger-with-bg"
            }
            else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.9) {
                textoParaMensagemFinal = "Pode melhorar na próxima, hein!"
                classComCoresParaMensagemFinal = "text-warning-with-bg"
            }
            else if (porcentagemFinalDeAcertos >= 0.9) {
                textoParaMensagemFinal = "Uau, parabéns!"
                classComCoresParaMensagemFinal = "text-success-with-bg"
            } //mensagens finais

            textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos) * 100) + "% das questões."

           

            document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal
            document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal)
            document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal

            document.getElementById('jogo').classList.add("text-new-gray")


            btnSubmeter.disabled = true
             fetch("/quiz/guardarPontuacao", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    pontuacaoServer: pontuacaoFinal,
                    idusuarioServer: sessionStorage.ID_USUARIO 
                })
            })
                .then(res => res.json())
                .then(data => {
                    console.log("Pontuação salva:", data);
                })
                .catch(err => {
                    console.error("Erro ao salvar pontuação:", err);
                });

        } /*Mostra a pontuação final e mensagem personalizada:
    
    menos de 30%: vermelho
    30% a 89%: laranja
    90% ou mais: verde
    desativa botão de submeter.*/
        window.onload = function () {
            onloadEsconder();
        };

    </script>
</body>

</html>