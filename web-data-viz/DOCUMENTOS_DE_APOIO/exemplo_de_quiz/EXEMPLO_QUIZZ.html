<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo - Quiz</title>
    <link rel="stylesheet" href="style.css">
</head>


<body>
    <div id="pontuacaoEJogo">

        <div id="quiz-cards" class="quiz-cards">
            <div class="card" data-quiz="livroAtos">Quiz Livro de Atos
                <button class="btnIniciarQuiz"">INICIAR QUIZ</button>

            </div>
            <div class="card" data-quiz="biblia1">Quiz Bíblia 1
                <button class="btnIniciarQuiz"">INICIAR QUIZ</button>

            </div>
            <div class="card" data-quiz="biblia2">Quiz Bíblia 2
                <button class="btnIniciarQuiz"">INICIAR QUIZ</button>

            </div>
            <div class="card" data-quiz="livroMateus">Quiz Livro de Mateus
                <button class="btnIniciarQuiz"">INICIAR QUIZ</button>

            </div>

        </div>


        <div id="pontuacao" class="flex-colunar width-fit-content border-primary">
            <div id="pontuacaoDuranteJogo" class="flex-colunar padding-8">
                <span class="width-fit-content">Quantidade de acertos: <span id="spanCertas"></span></span>
                <span class="width-fit-content">Quantidade de erros: <span id="spanErradas"></span></span>
            </div>
            <div id="pontuacaoFinalJogo" class="flex-colunar padding-8">
                <span id="pontuacaoFinal" class="width-fit-content">Pontuação Final:
                    <span id="spanPontuacaoFinal">***</span>
                </span>
                <span id="msgFinal" class="width-fit-content">***</span>
            </div>
        </div>

        <div id="jogo" class="width-fit-content flex-colunar border-secondary">

            <div id="infoQuestao" class="padding-8">
                <span>Questão atual: <span id="spanNumeroDaQuestaoAtual"></span> de <span id="qtdQuestoes"></span>
                    questões.</span>
            </div>

            <div id="perguntaDaQuestaoAtual" class="padding-8">
                <span id="spanQuestaoExibida" class="text-bold"></span>
            </div>

            <div id="infoAlternativas" class="padding-8">
                <span><em>Escolha uma opção dentre as abaixo:</em></span>
            </div>

            <div id="opcoes" class="flex-colunar padding-8">
                <span>
                    <input type="radio" id="primeiraOpcao" name="option" class="radio" value="alternativaA" />
                    <label for="primeiraOpcao" class="option" id="labelOpcaoUm"></label>
                </span>
                <span>
                    <input type="radio" id="segundaOpcao" name="option" class="radio" value="alternativaB" />
                    <label for="segundaOpcao" class="option" id="labelOpcaoDois"></label>
                </span>
                <span>
                    <input type="radio" id="terceiraOpcao" name="option" class="radio" value="alternativaC" />
                    <label for="terceiraOpcao" class="option" id="labelOpcaoTres"></label>
                </span>
                <span>
                    <input type="radio" id="quartaOpcao" name="option" class="radio" value="alternativaD" />
                    <label for="quartaOpcao" class="option" id="labelOpcaoQuatro"></label>
                </span>
            </div>

            <div id="botoes" class="flex-colunar padding-8">
                <button onclick="submeter()" id="btnSubmeter">Submeter resposta</button>
                <button onclick="avancar()" id="btnProx" disabled>Avançar para próxima questão</button>
                <!-- <button onclick="finalizar()" id="btnConcluir" disabled>Finalizar Quiz</button> -->
                <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar novamente</button>
            </div>

        </div>
    </div>
    <script>
        //vetor com 3 objetos, cada um representando uma pergunta com 4 alternativas e a alternativa correta.
        let quizLivroAtos = [

            {
                pergunta: "Qual mês tem 30 dias?",
                alternativaA: "Janeiro",
                alternativaB: "Dezembro",
                alternativaC: "Junho",
                alternativaD: "Agosto",
                alternativaCorreta: "alternativaC"
            },

            {
                pergunta: "Quantas horas tem em um dia?",
                alternativaA: "30 horas",
                alternativaB: "38 horas",
                alternativaC: "48 horas",
                alternativaD: "24 horas",
                alternativaCorreta: "alternativaD"
            },

            {
                pergunta: "Qual destes números é ímpar?",
                alternativaA: "Dez",
                alternativaB: "Doze",
                alternativaC: "Oito",
                alternativaD: "Onze",
                alternativaCorreta: "alternativaD"
            }

        ]

        let quizBiblia1 = [

            {
                pergunta: "Qual mês tem 30 dias?",
                alternativaA: "Janeiro",
                alternativaB: "Dezembro",
                alternativaC: "Junho",
                alternativaD: "Agosto",
                alternativaCorreta: "alternativaC"
            },

            {
                pergunta: "Quantas horas tem em um dia?",
                alternativaA: "30 horas",
                alternativaB: "38 horas",
                alternativaC: "48 horas",
                alternativaD: "24 horas",
                alternativaCorreta: "alternativaD"
            },

            {
                pergunta: "Qual destes números é ímpar?",
                alternativaA: "Dez",
                alternativaB: "Doze",
                alternativaC: "Oito",
                alternativaD: "Onze",
                alternativaCorreta: "alternativaD"
            }

        ]

        let quizBiblia2 = [

            {
                pergunta: "Qual mês moises dias?",
                alternativaA: "Janeiro",
                alternativaB: "Dezembro",
                alternativaC: "Junho",
                alternativaD: "Agosto",
                alternativaCorreta: "alternativaC"
            },

            {
                pergunta: "Quantas horas tem em um dia?",
                alternativaA: "30 horas",
                alternativaB: "38 horas",
                alternativaC: "48 horas",
                alternativaD: "24 horas",
                alternativaCorreta: "alternativaD"
            },

            {
                pergunta: "Qual destes números é ímpar?",
                alternativaA: "Dez",
                alternativaB: "Doze",
                alternativaC: "Oito",
                alternativaD: "Onze",
                alternativaCorreta: "alternativaD"
            }

        ]

        let quizLivroMateus = [

            {
                pergunta: "Qual mês tem 30 dias?",
                alternativaA: "Janeiro",
                alternativaB: "Dezembro",
                alternativaC: "Junho",
                alternativaD: "Agosto",
                alternativaCorreta: "alternativaC"
            },

            {
                pergunta: "Quantas horas tem em um dia?",
                alternativaA: "30 horas",
                alternativaB: "38 horas",
                alternativaC: "48 horas",
                alternativaD: "24 horas",
                alternativaCorreta: "alternativaD"
            },

            {
                pergunta: "Qual destes números é ímpar?",
                alternativaA: "Dez",
                alternativaB: "Doze",
                alternativaC: "Oito",
                alternativaD: "Onze",
                alternativaCorreta: "alternativaD"
            }

        ]

        // variáveis globais    
        let numeroDaQuestaoAtual = 0
        let pontuacaoFinal = 0
        let tentativaIncorreta = 0
        let certas = 0
        let erradas = 0
        let quantidadeDeQuestoes = quizLivroAtos.length
        let listaDeQuestoes = [];
        // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

        function onloadEsconder() {
            document.getElementById('pontuacao').style.display = "none"
            document.getElementById('jogo').style.display = "none"
        } //IMPORTANTE: essa função esconde a interface do quiz até o usuario clicar em iniciar

        document.querySelectorAll('.btnIniciarQuiz').forEach(button => {
    button.addEventListener('click', (e) => {
        const card = e.target.closest('.card');
        const quizSelecionado = card.getAttribute('data-quiz');

        if (quizSelecionado === "livroAtos") {
            listaDeQuestoes = quizLivroAtos;
        } else if (quizSelecionado === "biblia1") {
            listaDeQuestoes = quizBiblia1;
        } else if (quizSelecionado === "biblia2") {
            listaDeQuestoes = quizBiblia2;
        } else if (quizSelecionado === "livroMateus") {
            listaDeQuestoes = quizLivroMateus;
        }

        iniciarQuiz(); // Agora chamamos a função para iniciar o quiz
    });
});

function iniciarQuiz() {
    quantidadeDeQuestoes = listaDeQuestoes.length;
    document.getElementById('pontuacao').style.display = "flex";
    document.getElementById('jogo').style.display = "flex";

    // Oculta todos os botões de iniciar quiz
    document.querySelectorAll('.btnIniciarQuiz').forEach(btn => btn.style.display = "none");

    document.getElementById('qtdQuestoes').innerHTML = quantidadeDeQuestoes;

    preencherHTMLcomQuestaoAtual(0);

    btnSubmeter.disabled = false;
    btnProx.disabled = true;
    btnTentarNovamente.disabled = true;
    document.getElementById('quiz-cards').style.display = "none";

}//IMPORTANTE: essa função inicia o quiz, preenche a primeira pergunta, ativa os botões e reseta estados.

        function preencherHTMLcomQuestaoAtual(index) {
            habilitarAlternativas(true)
            const questaoAtual = listaDeQuestoes[index]
            numeroDaQuestaoAtual = index
            console.log("questaoAtual")
            console.log(questaoAtual)
            document.getElementById("spanNumeroDaQuestaoAtual").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
            document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
            document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
            document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
            document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
            document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
        } //pega a questão da lista pelo índice, mostra a pergunta e alternativas no html.

        function submeter() {
            const options = document.getElementsByName("option"); // recupera alternativas no html

            let hasChecked = false
            for (let i = 0; i < options.length; i++) {
                if (options[i].checked) {
                    hasChecked = true
                    break
                }
            }

            if (!hasChecked) {
                alert("Não há alternativas escolhidas. Escolha uma opção.")
            } else {
                btnSubmeter.disabled = true
                btnProx.disabled = false

                habilitarAlternativas(false)

                checarResposta()
            }
        } // verifica se alguma alternativa foi marcada, desativa envio/ativa botão “Próxima”, chama a funcao checarResposta() para validar a resposta.

        function habilitarAlternativas(trueOrFalse) {
            let opcaoEscolhida = trueOrFalse ? false : true

            primeiraOpcao.disabled = opcaoEscolhida
            segundaOpcao.disabled = opcaoEscolhida
            terceiraOpcao.disabled = opcaoEscolhida
            quartaOpcao.disabled = opcaoEscolhida

        }

        function avancar() {
            btnProx.disabled = true
            btnSubmeter.disabled = false

            desmarcarRadioButtons()

            if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {// se o numero da questao atual for menor que a penultima questao
                preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
            } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) { // se o numero da questao atual for igual a penultima questaão
                alert("Atenção... a próxima é a ultima questão!")
                preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
            } else { // se não, finalize o jogo
                finalizarJogo()
            }
            limparCoresBackgroundOpcoes()
        }// avança para a próxima pergunta, se acabou, chama a funcao finalizarJogo()

        function tentarNovamente() {
            // atualiza a página
            window.location.reload()
        }

        function checarResposta() {
            const questaoAtual = quizLivroAtos[numeroDaQuestaoAtual] // questão atual 
            const respostaQuestaoAtual = questaoAtual.alternativaCorreta // qual é a resposta correta da questão atual

            const options = document.getElementsByName("option"); // recupera alternativas no html

            let alternativaCorreta = null // variável para armazenar a alternativa correta

            options.forEach((option) => {
                if (option.value === respostaQuestaoAtual) {
                    alternativaCorreta = option.labels[0].id
                    console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                }
            })

            // verifica se resposta assinalada é correta
            options.forEach((option) => {
                if (option.checked === true && option.value === respostaQuestaoAtual) {
                    document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                    pontuacaoFinal++
                    certas++
                    document.getElementById("spanCertas").innerHTML = certas
                    numeroDaQuestaoAtual++
                } else if (option.checked && option.value !== respostaQuestaoAtual) {
                    const wrongLabelId = option.labels[0].id

                    document.getElementById(wrongLabelId).classList.add("text-danger-with-bg")
                    document.getElementById(alternativaCorreta).classList.add("text-success-with-bg")
                    tentativaIncorreta++
                    erradas++
                    document.getElementById("spanErradas").innerHTML = erradas
                    numeroDaQuestaoAtual++
                }
            })
        } // Verifica se a alternativa marcada é correta, atualiza a pontuação. Colore as alternativas: Verde: correta; Vermelha: errada

        function limparCoresBackgroundOpcoes() {
            const options = document.getElementsByName("option");
            options.forEach((option) => {
                document.getElementById(option.labels[0].id).classList.remove("text-danger-with-bg")
                document.getElementById(option.labels[0].id).classList.remove("text-success-with-bg")
            })
        }// Remove estilos das alternativas.


        function desmarcarRadioButtons() {
            const options = document.getElementsByName("option");
            for (let i = 0; i < options.length; i++) {
                options[i].checked = false;
            }
        }//Desmarca todas as opções marcadas.

        function finalizarJogo() {
            let textoParaMensagemFinal = null
            let classComCoresParaMensagemFinal = null
            const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes  //Cálculo de pontuaçao

            if (porcentagemFinalDeAcertos <= 0.3) {
                textoParaMensagemFinal = "Parece que você não estudou..."
                classComCoresParaMensagemFinal = "text-danger-with-bg"
            }
            else if (porcentagemFinalDeAcertos > 0.3 && porcentagemFinalDeAcertos < 0.9) {
                textoParaMensagemFinal = "Pode melhorar na próxima, hein!"
                classComCoresParaMensagemFinal = "text-warning-with-bg"
            }
            else if (porcentagemFinalDeAcertos >= 0.9) {
                textoParaMensagemFinal = "Uau, parabéns!"
                classComCoresParaMensagemFinal = "text-success-with-bg"
            } //mensagens finais

            textoParaMensagemFinal += "<br> Você acertou " + Math.round((porcentagemFinalDeAcertos) * 100) + "% das questões."


            document.getElementById('msgFinal').innerHTML = textoParaMensagemFinal
            document.getElementById('msgFinal').classList.add(classComCoresParaMensagemFinal)
            document.getElementById('spanPontuacaoFinal').innerHTML = pontuacaoFinal

            document.getElementById('jogo').classList.add("text-new-gray")

            btnProx.disabled = true
            btnSubmeter.disabled = true
            // btnConcluir.disabled = true
            btnTentarNovamente.disabled = false

        } /*Mostra a pontuação final e mensagem personalizada:
    
    menos de 30%: vermelho
    30% a 89%: laranja
    90% ou mais: verde
    desativa botões de submeter e avançar.
    ativa o botão "tentar novamente".*/
        window.onload = function () {
            onloadEsconder();
        };

    </script>
</body>

</html>